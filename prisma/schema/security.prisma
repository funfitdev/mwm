// =============================================================================
// API KEYS (for programmatic access)
// =============================================================================

model ApiKey {
  id          String    @id @default(cuid())
  userId      String
  name        String
  keyHash     String    @unique // Store hashed version of the key
  keyPrefix   String // First 8 chars for identification, e.g., "mwm_live_"
  permissions String[] // Array of permission names
  lastUsedAt  DateTime?
  expiresAt   DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([keyHash])
  @@index([keyPrefix])
  @@schema("public")
}

// =============================================================================
// AUDIT LOG (for security and compliance)
// =============================================================================

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String // e.g., "user.login", "user.logout", "role.assigned"
  resource   String? // e.g., "User", "Organization"
  resourceId String?
  metadata   Json? // Additional context
  ipAddress  String?
  userAgent  String?
  status     String   @default("success") // "success", "failure"
  createdAt  DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([action])
  @@index([resource, resourceId])
  @@index([createdAt])
  @@schema("public")
}
